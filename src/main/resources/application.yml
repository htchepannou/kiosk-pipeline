kiosk:
  namespace: "io.tchepannou"
  aws:
    connectionTimeout: 30000
    maxErrorRetries: 5
    s3:
      s3Bucket: "${kiosk.namespace}.kiosk"

  validation:
    minContentLength: 100

  service:
    ArticleDocumentFactory:
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"

    SimilarityService:
      shingleSize: 5      # Number of words per shingle
      maxShingles: 200    # Max shingle to use for computing similarity
      maxDays: 7          # Search for similary for articles for the last n days
      threadCount: 10     # Number of thread that fetch document content

    UrlBlacklistService:
      urls:
      - "*.pdf"         # PDF
      - "*.rss"         # RSS feeds
      - "*/feed/rss*"
      - "*/rss.php"
      - "*/wp-login*"   # Wordpress login
      - "*#*"           # URL with anchor
      - "*/[0-9]{4}/[0-9]{2}/[0-9]{2}"                  # Archives
      - "http://www.mamafrika.tv/blog/category/*"       # MamAfrika.tv
      - "http://www.237online.com/publications-du-*"    # 237 online
      - "https://lefilmcamerounais.com/category/*"      # Le Film Camerounais
      - "http://okabolmedia.com/category/*"             # Okabol Media
      - "http://achouka.mondoblog.org/tag/*"            # MondoBlog
      - "http://mondoblog.org/author/*"
      - "http://mondoblog.org/category/*"
      - "http://mamymuna.com/contact/"                  # Contact
      - "http://mamymuna.com/contribuer/"
      - "http://mamymuna.com/about/"
      - "http://mamymuna.com/members/"
      - "http://mamymuna.com/groupes/"
      - "http://mamymuna.com/inscriptions/"
      - "http://www.camerpost.com/page/*"              # CamerPost
      - "http://www.etoudiblog.com/search/*"           # EtoudiBlog
      - "http://www.etoudiblog.com/p/*"
      - "http://bamendaonline.net/blog/category/*"         # BamendaOnline
      - "http://bamendaonline.net/blog/author/*"           # BamendaOnline
      - "http://www.cameroun-online.com/fr/rubriques/*"    # CameronOnline
      - "http://www.cameroun-online.com/fr/Ã©tiquettes/*"
      - "http://www.cameroun-online.com/node/*"



  pipeline:
    reprocess: none        # none, extract-content
    maxThreadWait: 60000
    workersPerConsumer: 10

    FeedProducer:
      outputQueue: "kiosk-${kiosk.environment}-feed-queue"

    SimilarityMatrixProducer:
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/similarity"

    PublishProducer:
      outputQueue: "kiosk-${kiosk.environment}-article-publish-queue"

    UrlExtractorConsumer:
      inputQueue: "kiosk-${kiosk.environment}-feed-queue"
      outputQueue: "kiosk-${kiosk.environment}-url-queue"

    HtmlDownloadConsumer:
      inputQueue: "kiosk-${kiosk.environment}-url-queue"
      outputTopic: "arn:aws:sns:us-east-1:828725992074:kiosk-${kiosk.environment}-downloaded-topic"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/html"

    ArticleMetadataConsumer:
      inputQueue: "kiosk-${kiosk.environment}-matadata-extraction-queue"
      outputQueue: "kiosk-${kiosk.environment}-content-extraction-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"

    ArticleContentExtractorConsumer:
      inputQueue: "kiosk-${kiosk.environment}-content-extraction-queue"
      outputQueue: "kiosk-${kiosk.environment}-validation-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/content"
      s3KeyHtml: "${kiosk.pipeline.HtmlDownloadConsumer.s3Key}"

    ArticleValidationConsumer:
      inputQueue: "kiosk-${kiosk.environment}-validation-queue"

    ImageExtractorConsumer:
      inputQueue: "kiosk-${kiosk.environment}-image-extraction-queue"
      outputTopic: "arn:aws:sns:us-east-1:828725992074:kiosk-${kiosk.environment}-image-downloaded-topic"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/image"
      s3KeyHtml: "${kiosk.pipeline.HtmlDownloadConsumer.s3Key}"

    ImageThumbnailConsumer:
      inputQueue: "kiosk-${kiosk.environment}-image-thumbnail-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/image"
      width: 144
      height:  144

    ImageMainConsumer:
      inputQueue: "kiosk-${kiosk.environment}-image-main-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/image"
      width: 440
      height:  220

    VideoExtractorConsumer:
      inputQueue: "kiosk-${kiosk.environment}-video-extraction-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"

    ArticleDedupConsumer:
      inputQueue: "kiosk-${kiosk.environment}-article-dedup-queue"
      similarityThreshold: 0.8

    ArticlePublishConsumer:
      inputQueue: "kiosk-${kiosk.environment}-article-publish-queue"

spring:
  datasource:
    poolName: Kiosk.CP
    driverClassName: com.mysql.jdbc.Driver
    jdbcUrl: jdbc:mysql://127.0.0.1:3306/kiosk
    username: root
    #password:
    connectionTimeout: 30000
    connectionTestQuery: SELECT 1
    maximumPoolSize: 10
    idleTimeout: 15000
    maxLifetime: 60000
    leakDetectionThreshold: 30000
    dataSourceProperties:
      cachePrepStmts: true
      prepStmtCacheSize: 250
      prepStmtCacheSqlLimit: 2048

swagger:
  version: "1.0"
  title: Kiosk Processing Pipeline
  description: "Process Kiosk Messages"
  termsPath: ""
  email: "herve.tchepannou@gmail.com"
  licenceType: ""
  licencePath: "#"

endpoints:
  enabled: true
  health:
    sensitive: false
  info:
    sensitive: false
  metrics:
    sensitive: false

logging:
  level:
    root: INFO
    io.tchepannou.kiosk: INFO
    com.amazonaws: WARN
    org: WARN
    io: WARN
    springfix: WARN

  pattern:
    console: "%d Type=%level Thread=%thread Message='%m'%n"
    file: "%d Type=%level Thread=%thread Message='%m'%n"
