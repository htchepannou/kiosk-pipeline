kiosk:
  namespace: "io.tchepannou"
  aws:
    connectionTimeout: 30000
    maxErrorRetries: 5
    s3:
      s3Bucket: "${kiosk.namespace}.kiosk"

  validation:
    minContentLength: 100

  service:
    ArticleDocumentFactory:
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"

    SimilarityService:
      shingleSize: 5
      maxShingles: 200

    UrlBlacklistService:
      urls:
      - "/feed/rss"     # RSS feeds
      - "*/wp-login*"   # Wordpress login
      - "*#*"           # URL with anchors

  pipeline:
    autoStartPipeline: true
    maxThreadWait: 120000

    FeedProducer:
      outputQueue: "kiosk-${kiosk.environment}-feed-queue"

    SimilarityMatrixProducer:
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/similarity"

    UrlExtractorConsumer:
      inputQueue: "kiosk-${kiosk.environment}-feed-queue"
      outputQueue: "kiosk-${kiosk.environment}-url-queue"

    HtmlDownloadConsumer:
      inputQueue: "kiosk-${kiosk.environment}-url-queue"
      outputTopic: "arn:aws:sns:us-east-1:828725992074:kiosk-${kiosk.environment}-downloaded-topic"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/html"

    ArticleMetadataConsumer:
      inputQueue: "kiosk-${kiosk.environment}-matadata-extraction-queue"
      outputQueue: "kiosk-${kiosk.environment}-content-extraction-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"

    ArticleContentExtractorConsumer:
      inputQueue: "kiosk-${kiosk.environment}-content-extraction-queue"
      outputQueue: "kiosk-${kiosk.environment}-validation-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/content"
      s3KeyHtml: "${kiosk.pipeline.HtmlDownloadConsumer.s3Key}"

    ArticleValidationConsumer:
      inputQueue: "kiosk-${kiosk.environment}-validation-queue"

    ImageExtractorConsumer:
      inputQueue: "kiosk-${kiosk.environment}-image-extraction-queue"
      outputTopic: "arn:aws:sns:us-east-1:828725992074:kiosk-${kiosk.environment}-image-downloaded-topic"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/image"
      s3KeyHtml: "${kiosk.pipeline.HtmlDownloadConsumer.s3Key}"

    ImageThumbnailConsumer:
      inputQueue: "kiosk-${kiosk.environment}-image-thumbnail-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/image"
      width: 144
      height:  144

    ImageMainConsumer:
      inputQueue: "kiosk-${kiosk.environment}-image-main-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"
      s3Key: "${kiosk.environment}/image"
      width: 440
      height:  220

    VideoExtractorConsumer:
      inputQueue: "kiosk-${kiosk.environment}-video-extraction-queue"
      s3Bucket: "${kiosk.aws.s3.s3Bucket}"

    ArticleDedupConsumer:
      inputQueue: "kiosk-${kiosk.environment}-article-dedup-queue"
      similarityThreshold: 0.9

spring:
  datasource:
    poolName: Kiosk.CP
    driverClassName: com.mysql.jdbc.Driver
    jdbcUrl: jdbc:mysql://127.0.0.1:3306/kiosk
    username: root
    #password:
    connectionTimeout: 30000
    connectionTestQuery: SELECT 1
    maximumPoolSize: 10
    idleTimeout: 15000
    maxLifetime: 60000
    leakDetectionThreshold: 30000
    dataSourceProperties:
      cachePrepStmts: true
      prepStmtCacheSize: 250
      prepStmtCacheSqlLimit: 2048


swagger:
  version: "1.0"
  title: Kiosk Processing Pipeline
  description: "Process Kiosk Messages"
  termsPath: ""
  email: "herve.tchepannou@gmail.com"
  licenceType: ""
  licencePath: "#"

endpoints:
  enabled: true
  health:
    sensitive: false
  info:
    sensitive: false
  metrics:
    sensitive: false

logging:
  level:
    root: INFO
    io.tchepannou.kiosk: INFO
    com.amazonaws: WARN
    org: WARN
    io: WARN
    springfix: WARN

  pattern:
    console: "%d Type=%level Thread=%thread Message='%m'%n"
    file: "%d Type=%level Thread=%thread Message='%m'%n"
